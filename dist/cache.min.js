!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).cachePolyfill={})}(this,(function(e){"use strict";const t=new WeakMap,r=e=>t.get(e),n=(e,t)=>{if(t.length<e)throw new TypeError(`${e} argument required, but only ${t.length} present.`)},o=e=>e&&e instanceof Request;function s(){return new Promise(e=>{const t=indexedDB.open("cachestorage",4);t.onupgradeneeded=()=>{const e=t.result;e.createObjectStore("storages",{keyPath:"cacheName"}),e.createObjectStore("caches",{autoIncrement:!0}).createIndex("cacheName","cacheName",{unique:!1})},t.onsuccess=()=>{e(t.result)}})}var c=class{constructor(e){t.set(this,e)}match(...e){var t=this;return Promise.resolve().then((function(){return t.matchAll(...e)})).then((function(e){return e[0]}))}matchAll(e,t={}){var n=this;return Promise.resolve().then((function(){return"HEAD"===e.method?[]:Promise.resolve().then((function(){r(n);return s()})).then((function(t){const r=[],n=t.transaction("caches","readonly");return n.objectStore("caches").index("cacheName").openCursor(IDBKeyRange.only(cacheName)).onsuccess=function(){let t=this.result;if(t){if((e.url||e)===t.value.reqUrl){const e=Object.assign({url:t.value.resUrl},t.value),n=new Response(t.value.body,e);r.push(n)}t.continue()}},new Promise(e=>n.oncomplete=()=>e(r))}))})).then((function(){}))}add(e){var t=this,r=arguments;return Promise.resolve().then((function(){return n(1,r),t.addAll([e])}))}addAll(e){var t=arguments;return Promise.resolve().then((function(){n(1,t);let e=[];return fetch(req).then(t=>{if(206===t.status)throw new TypeError("Partial response (status code 206) is unsupported");if(!t.ok)throw new TypeError("Request failed");e.push([req,t])})})).then((function(){for(let t of e){if(t=new Request(t),!/^((http|https):\/\/)/.test(t.url))throw new TypeError('Add/AddAll does not support schemes other than "http" or "https"');if("GET"!==t.method)throw new TypeError("Add/AddAll only supports the GET request method");t.clone()}return Promise.all(results.map(e=>this.put(...e)))})).then((function(){}))}put(e,t){var u,a=this,i=arguments;return Promise.resolve().then((function(){return n(2,i),e=o(e)?e:new Request(e),a.delete(e)})).then((function(){if(!/^((http|https):\/\/)/.test(e.url))throw new TypeError(`Request scheme '${e.url.split(":")[0]}' is unsupported`);if("GET"!==e.method)throw new TypeError(`Request method '${e.method}' is unsupported`);if(206===t.status)throw new TypeError("Partial response (status code 206) is unsupported");let n=t.headers.get("Vary");if(n&&n.includes("*"))throw new TypeError("Vary header contains *");if(null!=t.body&&t.bodyUsed)throw new TypeError("Response body is already used");let o=r(a);return Promise.resolve().then((function(){return(u={}).cacheName=o,u.headers=[...t.headers],u.status=t.status,u.statusText=t.statusText,t.arrayBuffer()})).then((function(r){return u.body=r,u.reqUrl=e.url.replace(/#.*$/,""),u.resUrl=t.url.replace(/#.*$/,""),u.reqMethod=e.method,u}))})).then((function(e){return s()})).then((function(e){const t=e;return new Promise((e,r)=>{const n=t.transaction("caches","readwrite");n.objectStore("caches").put(c),n.oncomplete=()=>e(),n.onerror=()=>r(transaction.error)})})).then((function(){}))}delete(e,t={}){var c=this,u=arguments;return Promise.resolve().then((function(){n(1,u);const a=r(c),{ignoreMethod:i}=t,h=o(e)?e:new Request(e);return!(!["GET","HEAD"].includes(h.method)&&i)&&Promise.resolve().then((function(){h.url.replace(/#.*$/,"");return s()})).then((function(e){const t=e.transaction("caches","readwrite"),r=t.objectStore("caches"),n=r.index("cacheName").openCursor(IDBKeyRange.only(a));let o=!1;return n.onsuccess=function(){const e=this.result;e&&(url!==e.value.reqUrl||!i&&method!==e.value.reqMethod||(o=!0,r.delete(e.primaryKey)),e.continue())},new Promise(e=>t.oncomplete=()=>e(o))}))})).then((function(){}))}keys(e,t={}){var n,o=this;return Promise.resolve().then((function(){let c;const u=r(o),{ignoreMethod:a=!1,ignoreSearch:i=!1}=t;return(n=void 0!==e)&&(c=(e=new Request(e)).url.split("#")[0]),n&&"GET"!==e.method&&!a?[]:Promise.resolve().then((function(){return s()})).then((function(e){const t=e;return new Promise(e=>{const r=t.transaction("caches","readonly").objectStore("caches").index("cacheName").getAll(IDBKeyRange.only(u));r.onsuccess=()=>e(r.result)})})).then((function(e){return search(e).map(e=>new Request(e.reqUrl))}))})).then((function(){}))}};function u(){return new Promise(e=>{const t=indexedDB.open("cachestorage",4);t.onupgradeneeded=function(){const e=t.result;e.createObjectStore("storages",{keyPath:"cacheName"});e.createObjectStore("caches",{autoIncrement:!0}).createIndex("cacheName","cacheName",{unique:!1})},t.onsuccess=()=>{e(t.result)}})}class a{delete(e){var t,r,n,o,s=this;return Promise.resolve().then((function(){return s.keys()})).then((function(s){return!!s.includes(e)&&Promise.resolve().then((function(){return u()})).then((function(s){return t=s.transaction(["storages","caches"],"readwrite"),r=t.objectStore("storages"),r.delete(e),n=t.objectStore("caches"),o=n.index("cacheName"),o.getAllKeys(IDBKeyRange.only(e)).onsuccess=function(e){for(let e of this.result)n.delete(e)},new Promise((e,r)=>{t.oncomplete=()=>e(!0),t.onerror=()=>r(!1)})}))})).then((function(){}))}has(e){return this.keys().then(t=>t.includes(e))}keys(){var e,t,r;return Promise.resolve().then((function(){return u()})).then((function(n){return e=n.transaction("storages","readonly"),t=e.objectStore("storages"),r=t.getAllKeys(),new Promise(e=>r.onsuccess=()=>e(r.result))}))}match(...e){var t=this;return Promise.resolve().then((function(){return t.keys()})).then((function(e){return t.open(key)})).then((function(t){return cache.match(...e)})).then((function(e){for(let t of keys){let t=e;if(t)return t}}))}open(e){var t=arguments;return Promise.resolve().then((function(){if(t.length<1)throw new TypeError(`${i} argument required, but only ${t.length} present.`);return u()})).then((function(t){const r=t;return new Promise((t,n)=>{const o=r.transaction("storages","readwrite");o.objectStore("storages").put({cacheName:e}),o.oncomplete=()=>t(),o.onerror=()=>n(transaction.error)})})).then((function(){return new c(e)}))}[Symbol.toStringTag](){return"CacheStorage"}}var h={Cache:c,CacheStorage:a,caches:new a},l=h.Cache,d=h.CacheStorage,f=h.caches;e.Cache=l,e.CacheStorage=d,e.__moduleExports=h,e.caches=f,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=cache.min.js.map
