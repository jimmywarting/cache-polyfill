!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).cachePolyfill={})}(this,(function(e){"use strict";function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function n(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}function o(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function u(e,t,r){return r?t?t(e):e:(e&&e.then||(e=Promise.resolve(e)),t?e.then(t):e)}var c=new WeakMap;function a(e,t,r){if(r)return t?t(e()):e();try{var n=Promise.resolve(e());return t?n.then(t):n}catch(e){return Promise.reject(e)}}var s=function(e){return c.get(e)};function f(){}var h=function(e,t){if(t.length<e)throw new TypeError("".concat(e," argument required, but only ").concat(t.length," present."))};function l(e,t){if(!t)return e&&e.then?e.then(f):Promise.resolve()}var d=function(e){return e&&e instanceof Request},y="undefined"!=typeof Symbol?Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator")):"@@iterator";function v(e,t,r){if(!e.s){if(r instanceof p){if(!r.s)return void(r.o=v.bind(null,e,t));1&t&&(t=r.s),r=r.v}if(r&&r.then)return void r.then(v.bind(null,e,t),v.bind(null,e,2));e.s=t,e.v=r;var n=e.o;n&&n(e)}}var p=function(){function e(){}return e.prototype.then=function(t,r){var n=new e,o=this.s;if(o){var u=1&o?t:r;if(u){try{v(n,1,u(this.v))}catch(e){v(n,2,e)}return n}return this}return this.o=function(e){try{var o=e.v;1&e.s?v(n,1,t?t(o):o):r?v(n,1,r(o)):v(n,2,o)}catch(e){v(n,2,e)}},n},e}();function m(e){return e instanceof p&&1&e.s}function w(e,t,r){if("function"==typeof e[y]){var n,o,u,c=e[y]();if(function e(i){try{for(;!((n=c.next()).done||r&&r());)if((i=t(n.value))&&i.then){if(!m(i))return void i.then(e,u||(u=v.bind(null,o=new p,2)));i=i.v}o?v(o,1,i):o=i}catch(e){v(o||(o=new p),2,e)}}(),c.return){var i=function(e){try{n.done||c.return()}catch(e){}return e};if(o&&o.then)return o.then(i,(function(e){throw i(e)}));i()}return o}if(!("length"in e))throw new TypeError("Object is not iterable");for(var a=[],s=0;s<e.length;s++)a.push(e[s]);return function(e,t,r){var n,o,u=-1;return function c(i){try{for(;++u<e.length&&(!r||!r());)if((i=t(u))&&i.then){if(!m(i))return void i.then(c,o||(o=v.bind(null,n=new p,2)));i=i.v}n?v(n,1,i):n=i}catch(e){v(n||(n=new p),2,e)}}(),n}(a,(function(e){return t(a[e])}),r)}function b(e,t){return e&&e.then?e.then(t):t(e)}function g(){return new Promise((function(e){var t=indexedDB.open("cachestorage",4);t.onupgradeneeded=function(){var e=t.result;e.createObjectStore("storages",{keyPath:"cacheName"}),e.createObjectStore("caches",{autoIncrement:!0}).createIndex("cacheName","cacheName",{unique:!1})},t.onsuccess=function(){e(t.result)}}))}var P=function(){function e(r){t(this,e),c.set(this,r)}return n(e,[{key:"match",value:function(){try{var e=this;return u(e.matchAll.apply(e,arguments),(function(e){return e[0]}))}catch(e){return Promise.reject(e)}}},{key:"matchAll",value:function(e){try{if("HEAD"===e.method)return[];var t=s(this);return a(g,(function(r){var n=[],o=r.transaction("caches","readonly");return o.objectStore("caches").index("cacheName").openCursor(IDBKeyRange.only(t)).onsuccess=function(){var t=this.result;if(t){if((e.url||e)===t.value.reqUrl){var r=Object.assign({url:t.value.resUrl},t.value),o=new Response(t.value.body,r);n.push(o)}t.continue()}},new Promise((function(e){return o.oncomplete=function(){return e(n)}}))}))}catch(e){return Promise.reject(e)}}},{key:"add",value:function(e){try{var t=arguments,r=this;return h(1,t),r.addAll([e])}catch(e){return Promise.reject(e)}}},{key:"addAll",value:function(e){try{var t=!1,r=arguments,n=this;h(1,r);var u=[];return b(w(e,(function(e){if(e=new Request(e),!/^((http|https):\/\/)/.test(e.url))throw new TypeError('Add/AddAll does not support schemes other than "http" or "https"');if("GET"!==e.method)throw new TypeError("Add/AddAll only supports the GET request method");e.clone();return l(fetch(e).then((function(t){if(206===t.status)throw new TypeError("Partial response (status code 206) is unsupported");if(!t.ok)throw new TypeError("Request failed");u.push([e,t])})))}),(function(){return t})),(function(e){return t?e:l(Promise.all(u.map((function(e){return n.put.apply(n,o(e))}))))}))}catch(e){return Promise.reject(e)}}},{key:"put",value:function(e,t){try{var r=arguments,n=this;return h(2,r),e=d(e)?e:new Request(e),u(n.delete(e),(function(){if(!/^((http|https):\/\/)/.test(e.url))throw new TypeError("Request scheme '".concat(e.url.split(":")[0],"' is unsupported"));if("GET"!==e.method)throw new TypeError("Request method '".concat(e.method,"' is unsupported"));if(206===t.status)throw new TypeError("Partial response (status code 206) is unsupported");var r=t.headers.get("Vary");if(r&&r.includes("*"))throw new TypeError("Vary header contains *");if(null!=t.body&&t.bodyUsed)throw new TypeError("Response body is already used");var c=s(n),i=t.statusText,f=t.status,h=o(t.headers);return u(t.arrayBuffer(),(function(r){var n={cacheName:c,headers:h,status:f,statusText:i,body:r,reqUrl:e.url.replace(/#.*$/,""),resUrl:t.url.replace(/#.*$/,""),reqMethod:e.method};return a(g,(function(e){return l(new Promise((function(t,r){var o=e.transaction("caches","readwrite");o.objectStore("caches").put(n),o.oncomplete=function(){return t()},o.onerror=function(){return r(transaction.error)}})))}))}))}))}catch(e){return Promise.reject(e)}}},{key:"delete",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{var r=arguments,n=this;h(1,r);var o=s(n),u=t.ignoreMethod,c=d(e)?e:new Request(e);if(!["GET","HEAD"].includes(c.method)&&u)return!1;var i=c.method,f=c.url.replace(/#.*$/,"");return a(g,(function(e){var t=e.transaction("caches","readwrite"),r=t.objectStore("caches"),n=r.index("cacheName").openCursor(IDBKeyRange.only(o)),c=!1;return n.onsuccess=function(){var e=this.result;e&&(f!==e.value.reqUrl||!u&&i!==e.value.reqMethod||(c=!0,r.delete(e.primaryKey)),e.continue())},new Promise((function(e){return t.oncomplete=function(){return e(c)}}))}))}catch(e){return Promise.reject(e)}}},{key:"keys",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{var r,n=this,o=s(n),c=t.ignoreMethod,i=void 0!==c&&c,f=t.ignoreSearch,h=void 0!==f&&f;if(void 0!==e&&(e=new Request(e),r=e.url.split("#")[0],"GET"!==e.method&&!i))return[];var l=void 0===e?function(e){return e}:function(e){return e.filter((function(e){return h?(e=e.reqUrl.split("?")[0],r=r.split("?")[0]):e=e.reqUrl,e===r}))};return a(g,(function(e){return u(new Promise((function(t){var r=e.transaction("caches","readonly").objectStore("caches").index("cacheName").getAll(IDBKeyRange.only(o));r.onsuccess=function(){return t(r.result)}})),(function(e){return l(e).map((function(e){return new Request(e.reqUrl)}))}))}))}catch(e){return Promise.reject(e)}}}]),e}();function j(e,t,r){if(r)return t?t(e()):e();try{var n=Promise.resolve(e());return t?n.then(t):n}catch(e){return Promise.reject(e)}}function S(e,t,r){return r?t?t(e):e:(e&&e.then||(e=Promise.resolve(e)),t?e.then(t):e)}var k="undefined"!=typeof Symbol?Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator")):"@@iterator";function E(e,t,r){if(!e.s){if(r instanceof T){if(!r.s)return void(r.o=E.bind(null,e,t));1&t&&(t=r.s),r=r.v}if(r&&r.then)return void r.then(E.bind(null,e,t),E.bind(null,e,2));e.s=t,e.v=r;var n=e.o;n&&n(e)}}var T=function(){function e(){}return e.prototype.then=function(t,r){var n=new e,o=this.s;if(o){var u=1&o?t:r;if(u){try{E(n,1,u(this.v))}catch(e){E(n,2,e)}return n}return this}return this.o=function(e){try{var o=e.v;1&e.s?E(n,1,t?t(o):o):r?E(n,1,r(o)):E(n,2,o)}catch(e){E(n,2,e)}},n},e}();function q(e){return e instanceof T&&1&e.s}function x(e,t,r){if("function"==typeof e[k]){var n,o,u,c=e[k]();if(function e(i){try{for(;!((n=c.next()).done||r&&r());)if((i=t(n.value))&&i.then){if(!q(i))return void i.then(e,u||(u=E.bind(null,o=new T,2)));i=i.v}o?E(o,1,i):o=i}catch(e){E(o||(o=new T),2,e)}}(),c.return){var i=function(e){try{n.done||c.return()}catch(e){}return e};if(o&&o.then)return o.then(i,(function(e){throw i(e)}));i()}return o}if(!("length"in e))throw new TypeError("Object is not iterable");for(var a=[],s=0;s<e.length;s++)a.push(e[s]);return function(e,t,r){var n,o,u=-1;return function c(i){try{for(;++u<e.length&&(!r||!r());)if((i=t(u))&&i.then){if(!q(i))return void i.then(c,o||(o=E.bind(null,n=new T,2)));i=i.v}n?E(n,1,i):n=i}catch(e){E(n||(n=new T),2,e)}}(),n}(a,(function(e){return t(a[e])}),r)}function A(){return new Promise((function(e){var t=indexedDB.open("cachestorage",4);t.onupgradeneeded=function(){var e=t.result;e.createObjectStore("storages",{keyPath:"cacheName"});e.createObjectStore("caches",{autoIncrement:!0}).createIndex("cacheName","cacheName",{unique:!1})},t.onsuccess=function(){e(t.result)}}))}var R=function(){function e(){t(this,e)}return n(e,[{key:"delete",value:function(e){try{return S(this.keys(),(function(t){return!!t.includes(e)&&j(A,(function(t){tx=t.transaction(["storages","caches"],"readwrite");tx.objectStore("storages").delete(e);return caches=tx.objectStore("caches"),caches.index("cacheName").getAllKeys(IDBKeyRange.only(e)).onsuccess=function(e){var t=!0,r=!1,n=void 0;try{for(var o,u=this.result[Symbol.iterator]();!(t=(o=u.next()).done);t=!0){var c=o.value;caches.delete(c)}}catch(e){r=!0,n=e}finally{try{t||null==u.return||u.return()}finally{if(r)throw n}}},new Promise((function(e,t){tx.oncomplete=function(){return e(!0)},tx.onerror=function(){return t(!1)}}))}))}))}catch(e){return Promise.reject(e)}}},{key:"has",value:function(e){return this.keys().then((function(t){return t.includes(e)}))}},{key:"keys",value:function e(){return j(A,(function(t){var r=t.transaction("storages","readonly").objectStore("storages");return e=r.getAllKeys(),new Promise((function(t){return e.onsuccess=function(){return t(e.result)}}))}))}},{key:"match",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];try{var n=this;return S(n.keys(),(function(e){var r=!1;return x(e,(function(e){return S(n.open(e),(function(e){return S(e.match.apply(e,t),(function(e){if(e)return r=!0,e}))}))}),(function(){return r}))}))}catch(e){return Promise.reject(e)}}},{key:"open",value:function(e){try{var t=arguments;if(t.length<1)throw new TypeError("".concat(i," argument required, but only ").concat(t.length," present."));return j(A,(function(t){return S(new Promise((function(r,n){var o=t.transaction("storages","readwrite");o.objectStore("storages").put({cacheName:e}),o.oncomplete=function(){return r()},o.onerror=function(){return n(transaction.error)}})),(function(){return new P(e)}))}))}catch(e){return Promise.reject(e)}}},{key:Symbol.toStringTag,value:function(){return"CacheStorage"}}]),e}(),N={Cache:P,CacheStorage:R,caches:new R},O=N.Cache,C=N.CacheStorage,I=N.caches;e.Cache=O,e.CacheStorage=C,e.__moduleExports=N,e.caches=I,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=cache.min.js.map
