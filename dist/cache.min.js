!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).cachePolyfill={})}(this,(function(e){"use strict";function t(e,t,r,n,a,o,u){try{var c=e[o](u),s=c.value}catch(e){return void r(e)}c.done?t(s):Promise.resolve(s).then(n,a)}function r(e){return function(){var r=this,n=arguments;return new Promise((function(a,o){var u=e.apply(r,n);function c(e){t(u,a,o,c,s,"next",e)}function s(e){t(u,a,o,c,s,"throw",e)}c(void 0)}))}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(e,t,r){return t&&a(e.prototype,t),r&&a(e,r),e}function u(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var c=new WeakMap,s=function(e){return c.get(e)},l=function(e,t){if(t.length<e)throw new TypeError("".concat(e," argument required, but only ").concat(t.length," present."))},p=function(e){return e&&e instanceof Request};function h(){return new Promise((function(e){var t=indexedDB.open("cachestorage",4);t.onupgradeneeded=function(){var e=t.result;e.createObjectStore("storages",{keyPath:"cacheName"}),e.createObjectStore("caches",{autoIncrement:!0}).createIndex("cacheName","cacheName",{unique:!1})},t.onsuccess=function(){e(t.result)}}))}var f=function(){function e(t){n(this,e),c.set(this,t)}var t,a,i,f,d,m,y;return o(e,[{key:"match",value:(y=r(regeneratorRuntime.mark((function e(){var t=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.matchAll.apply(this,t);case 2:return e.abrupt("return",e.sent[0]);case 3:case"end":return e.stop()}}),e,this)}))),function(){return y.apply(this,arguments)})},{key:"matchAll",value:(m=r(regeneratorRuntime.mark((function e(t){var r,n,a,o,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("HEAD"!==t.method){e.next=3;break}return e.abrupt("return",[]);case 3:return r=s(this),e.next=6,h();case 6:return n=e.sent,a=[],o=n.transaction("caches","readonly"),u=o.objectStore("caches"),u.index("cacheName").openCursor(IDBKeyRange.only(r)).onsuccess=function(){var e=this.result;if(e){if((t.url||t)===e.value.reqUrl){var r=Object.assign({url:e.value.resUrl},e.value),n=new Response(e.value.body,r);a.push(n)}e.continue()}},e.abrupt("return",new Promise((function(e){return o.oncomplete=function(){return e(a)}})));case 14:case"end":return e.stop()}}),e,this)}))),function(e){return m.apply(this,arguments)})},{key:"add",value:(d=r(regeneratorRuntime.mark((function e(t){var r=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l(1,r),e.abrupt("return",this.addAll([t]));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return d.apply(this,arguments)})},{key:"addAll",value:(f=r(regeneratorRuntime.mark((function e(t){var r,n,a,o,c,s,i,p=this,h=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:l(1,h),r=[],n=!0,a=!1,o=void 0,e.prev=5,c=regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=i.value,t=new Request(t),/^((http|https):\/\/)/.test(t.url)){e.next=4;break}throw new TypeError('Add/AddAll does not support schemes other than "http" or "https"');case 4:if("GET"===t.method){e.next=6;break}throw new TypeError("Add/AddAll only supports the GET request method");case 6:return t.clone(),e.next=9,fetch(t).then((function(e){if(206===e.status)throw new TypeError("Partial response (status code 206) is unsupported");if(!e.ok)throw new TypeError("Request failed");r.push([t,e])}));case 9:case"end":return e.stop()}}),e)})),s=t[Symbol.iterator]();case 8:if(n=(i=s.next()).done){e.next=13;break}return e.delegateYield(c(),"t0",10);case 10:n=!0,e.next=8;break;case 13:e.next=19;break;case 15:e.prev=15,e.t1=e.catch(5),a=!0,o=e.t1;case 19:e.prev=19,e.prev=20,n||null==s.return||s.return();case 22:if(e.prev=22,!a){e.next=25;break}throw o;case 25:return e.finish(22);case 26:return e.finish(19);case 27:return e.next=29,Promise.all(r.map((function(e){return p.put.apply(p,u(e))})));case 29:case"end":return e.stop()}}),e,null,[[5,15,19,27],[20,,22,26]])}))),function(e){return f.apply(this,arguments)})},{key:"put",value:(i=r(regeneratorRuntime.mark((function e(t,r){var n,a,o,c,i=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l(2,i),t=p(t)?t:new Request(t),e.next=4,this.delete(t);case 4:if(/^((http|https):\/\/)/.test(t.url)){e.next=6;break}throw new TypeError("Request scheme '".concat(t.url.split(":")[0],"' is unsupported"));case 6:if("GET"===t.method){e.next=8;break}throw new TypeError("Request method '".concat(t.method,"' is unsupported"));case 8:if(206!==r.status){e.next=10;break}throw new TypeError("Partial response (status code 206) is unsupported");case 10:if(!(n=r.headers.get("Vary"))||!n.includes("*")){e.next=13;break}throw new TypeError("Vary header contains *");case 13:if(null==r.body){e.next=16;break}if(!r.bodyUsed){e.next=16;break}throw new TypeError("Response body is already used");case 16:return a=s(this),e.t0=a,e.t1=u(r.headers),e.t2=r.status,e.t3=r.statusText,e.next=23,r.arrayBuffer();case 23:return e.t4=e.sent,e.t5=t.url.replace(/#.*$/,""),e.t6=r.url.replace(/#.*$/,""),e.t7=t.method,o={cacheName:e.t0,headers:e.t1,status:e.t2,statusText:e.t3,body:e.t4,reqUrl:e.t5,resUrl:e.t6,reqMethod:e.t7},e.next=30,h();case 30:return c=e.sent,e.next=33,new Promise((function(e,t){var r=c.transaction("caches","readwrite");r.objectStore("caches").put(o),r.oncomplete=function(){return e()},r.onerror=function(){return t(transaction.error)}}));case 33:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})},{key:"delete",value:(a=r(regeneratorRuntime.mark((function e(t){var r,n,a,o,u,c,i,f,d,m,y,v,w=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=w.length>1&&void 0!==w[1]?w[1]:{},l(1,w),n=s(this),a=r.ignoreMethod,o=p(t)?t:new Request(t),["GET","HEAD"].includes(o.method)||!a){e.next=7;break}return e.abrupt("return",!1);case 7:return u=o.method,c=o.url.replace(/#.*$/,""),e.next=11,h();case 11:return i=e.sent,f=i.transaction("caches","readwrite"),d=f.objectStore("caches"),m=d.index("cacheName"),y=m.openCursor(IDBKeyRange.only(n)),v=!1,y.onsuccess=function(){var e=this.result;e&&(c!==e.value.reqUrl||!a&&u!==e.value.reqMethod||(v=!0,d.delete(e.primaryKey)),e.continue())},e.abrupt("return",new Promise((function(e){return f.oncomplete=function(){return e(v)}})));case 19:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"keys",value:(t=r(regeneratorRuntime.mark((function e(t){var r,n,a,o,u,c,i,l,p,f,d=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=d.length>1&&void 0!==d[1]?d[1]:{},a=s(this),o=r.ignoreMethod,u=void 0!==o&&o,c=r.ignoreSearch,i=void 0!==c&&c,void 0===t){e.next=8;break}if(t=new Request(t),n=t.url.split("#")[0],"GET"===t.method||u){e.next=8;break}return e.abrupt("return",[]);case 8:return l=void 0===t?function(e){return e}:function(e){return e.filter((function(e){return i?(e=e.reqUrl.split("?")[0],n=n.split("?")[0]):e=e.reqUrl,e===n}))},e.next=11,h();case 11:return p=e.sent,e.next=14,new Promise((function(e){var t=p.transaction("caches","readonly").objectStore("caches").index("cacheName").getAll(IDBKeyRange.only(a));t.onsuccess=function(){return e(t.result)}}));case 14:return f=e.sent,e.abrupt("return",l(f).map((function(e){return new Request(e.reqUrl)})));case 16:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}();function d(){return new Promise((function(e){var t=indexedDB.open("cachestorage",4);t.onupgradeneeded=function(){var e=t.result;e.createObjectStore("storages",{keyPath:"cacheName"});e.createObjectStore("caches",{autoIncrement:!0}).createIndex("cacheName","cacheName",{unique:!1})},t.onsuccess=function(){e(t.result)}}))}var m=function(){function e(){n(this,e)}var t,a,u,c;return o(e,[{key:"delete",value:(c=r(regeneratorRuntime.mark((function e(t){var r,n,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.keys();case 2:if(e.sent.includes(t)){e.next=5;break}return e.abrupt("return",!1);case 5:return e.next=7,d();case 7:return r=e.sent,n=r.transaction(["storages","caches"],"readwrite"),n.objectStore("storages").delete(t),a=n.objectStore("caches"),a.index("cacheName").getAllKeys(IDBKeyRange.only(t)).onsuccess=function(e){var t=!0,r=!1,n=void 0;try{for(var o,u=this.result[Symbol.iterator]();!(t=(o=u.next()).done);t=!0){var c=o.value;a.delete(c)}}catch(e){r=!0,n=e}finally{try{t||null==u.return||u.return()}finally{if(r)throw n}}},e.abrupt("return",new Promise((function(e,t){n.oncomplete=function(){return e(!0)},n.onerror=function(){return t(!1)}})));case 16:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"has",value:function(e){return this.keys().then((function(t){return t.includes(e)}))}},{key:"keys",value:(u=r(regeneratorRuntime.mark((function e(){var t,r,n,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d();case 2:return t=e.sent,r=t.transaction("storages","readonly"),n=r.objectStore("storages"),a=n.getAllKeys(),e.abrupt("return",new Promise((function(e){return a.onsuccess=function(){return e(a.result)}})));case 7:case"end":return e.stop()}}),e)}))),function(){return u.apply(this,arguments)})},{key:"match",value:(a=r(regeneratorRuntime.mark((function e(){var t,r,n,a,o,u,c,s,i,l=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.keys();case 2:t=e.sent,r=!0,n=!1,a=void 0,e.prev=6,o=t[Symbol.iterator]();case 8:if(r=(u=o.next()).done){e.next=21;break}return c=u.value,e.next=12,this.open(c);case 12:return s=e.sent,e.next=15,s.match.apply(s,l);case 15:if(!(i=e.sent)){e.next=18;break}return e.abrupt("return",i);case 18:r=!0,e.next=8;break;case 21:e.next=27;break;case 23:e.prev=23,e.t0=e.catch(6),n=!0,a=e.t0;case 27:e.prev=27,e.prev=28,r||null==o.return||o.return();case 30:if(e.prev=30,!n){e.next=33;break}throw a;case 33:return e.finish(30);case 34:return e.finish(27);case 35:case"end":return e.stop()}}),e,this,[[6,23,27,35],[28,,30,34]])}))),function(){return a.apply(this,arguments)})},{key:"open",value:(t=r(regeneratorRuntime.mark((function e(t){var r,n=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n.length<1)){e.next=2;break}throw new TypeError("".concat(i," argument required, but only ").concat(n.length," present."));case 2:return e.next=4,d();case 4:return r=e.sent,e.next=7,new Promise((function(e,n){var a=r.transaction("storages","readwrite");a.objectStore("storages").put({cacheName:t}),a.oncomplete=function(){return e()},a.onerror=function(){return n(transaction.error)}}));case 7:return e.abrupt("return",new f(t));case 8:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})},{key:Symbol.toStringTag,value:function(){return"CacheStorage"}}]),e}(),y={Cache:f,CacheStorage:m,caches:new m},v=y.Cache,w=y.CacheStorage,b=y.caches;e.Cache=v,e.CacheStorage=w,e.__moduleExports=y,e.caches=b,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=cache.min.js.map
